# Data Exfiltration Detection
**Date:** 2026-01-31

**Objective:**
- detect exfiltration attempts using network traffic analysis.
- Identify signs of exfiltration on endpoint devices.
- Correlate logs in a SIEM to uncover hidden exfiltration channels.


**Environment:** TryHackMe – “Data Exfiltration Detection” room  
**Tools Used:** Wireshark, Splunk

<img width="1440" height="621" alt="Screenshot 2026-02-01 at 7 49 13 AM" src="https://github.com/user-attachments/assets/9ac439cf-d321-448b-99fc-a83e6c42efbb" />
- Time must be set to "All time" once selecting a file to work in

## Identifying DNS Exfiltration Through Wireshark

Upon filtering for "dns", there are a few things that can be identified:
<img width="1440" height="768" alt="Screenshot 2026-02-01 at 8 25 40 AM" src="https://github.com/user-attachments/assets/63a69d6e-9ec6-452a-85f5-f5b5f0605e7a" />
- The external domain name contains jumbled characters prior to the actual domain unlike some of the other domains such as "github.com" or "stackoverflow.com"
- The query length is larger than the others with regular-looking domain names on average
- Multiple internal IPs are contacting this external domain


To support this, I can search for query legnths greater than the typical amount
<img width="1440" height="645" alt="Screenshot 2026-02-01 at 8 39 13 AM" src="https://github.com/user-attachments/assets/92f74df7-d200-4c55-92f5-0b4e786d50bd" />


The domain name can also be filtered:
<img width="1440" height="645" alt="Screenshot 2026-02-01 at 8 50 12 AM" src="https://github.com/user-attachments/assets/54fdd924-0bc4-4710-b6f8-dc6707bd22bd" />


## Identifying DNS Exfiltration Through Splunk

### Displaying stats generated by IP
<img width="1440" height="572" alt="Screenshot 2026-02-01 at 9 23 42 AM" src="https://github.com/user-attachments/assets/9436d1a8-8f80-4a9b-ae36-00cc5c7dfd4a" />
- The IPs listed show how many alerts in total were created by the specific IP

### Displaying queried sites
<img width="1440" height="764" alt="Screenshot 2026-02-01 at 9 25 35 AM" src="https://github.com/user-attachments/assets/447c27fb-c8d8-4d85-affe-381715471bc5" />
- This is showing which and how many times a site was queried in the log for a given timeframe

##

### How many suspicious traffic/logs related to dns tunneling were observed?
To answer this, I'll be filtering for query lengths greater than 30

<img width="1440" height="764" alt="Screenshot 2026-02-01 at 11 52 32 AM" src="https://github.com/user-attachments/assets/0784e920-b427-44ee-9778-a13c5bb2982f" />

- 315

##

### Which local IP sent the maximum number of suspicious requests?
For this, I had to mess around with the query a little to include filtering for the suspicious query length size and including the stats for IPs that were involved with querying those domains.

<img width="1440" height="600" alt="Screenshot 2026-02-01 at 12 00 53 PM" src="https://github.com/user-attachments/assets/1ec5157a-803c-4cbc-a383-a4aa088d5cf8" />

- 192.168.1.103 has the most queries to the tunnelcorp.net domain

## FTP Data Exfiltration

### How many connections were observed from the guest account?
I could use the "ftp.request.command == 'USER'" filter and search through the list of users until guest is found and filter for that, but I found "ftp contains 'guest'" to be efficient.

<img width="1440" height="796" alt="Screenshot 2026-02-01 at 12 38 35 PM" src="https://github.com/user-attachments/assets/eff2019d-8dd6-4fab-9efb-f30778142fc4" />

- 5


### Apply the filter; what is the name of the customer-related file exfiltrated from the root account?
They say "Apply the filter" which is ambiguous, so I've applied the "ftp contains 'STOR'" filter and included "ftp contains 'root'" since there's a present root account in the PCAP.

<img width="1440" height="413" alt="Screenshot 2026-02-01 at 12 54 08 PM" src="https://github.com/user-attachments/assets/62bf40a9-3a7e-4c8f-9e5e-d45e252e4ebc" />

The customer-related file is:
- customer_data.xlsx

##

### Which internal IP was found to be sending the largest payload to an external IP?
There's no files ingested in Splunk so I have to mannualy search in Wireshark.

For this, I'll use the "Statistics > Conversation option" 

To clarify, I did filter for all of the other internal IPs before selecting the one I'm showing ahead.

By right clicking the source IP that ends in ".105" I selected "Apply as Filter > Selected > A -> Any" (emphasis on sending).

<img width="1440" height="768" alt="Screenshot 2026-02-01 at 1 58 56 PM" src="https://github.com/user-attachments/assets/5ea3b68b-7d5f-4a13-86fa-6f2f09ff8642" />

This internal IP had the highest percentage of communicating more frequent to the external IP than any other along with the byte sizes

